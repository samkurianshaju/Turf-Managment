const User = require("../model/User");

const getAllUser = async(req,res,next) =>{
   let users;
   try{
      users = await User.find();
   }catch(err){
      console.log(err);
   }
   if(!users){
      return res.status(400).json({message:"No records found"})
   }
   return res.status(200).json({users});
}

const getById = async(req,res,next) =>{
   const id = req.params.id; //colllect id from url
   let user;
   try{
      user = await User.findById(id);
   }catch (err){
      console.log.apply(err)
   }
   if(!user){
      return res.status(400).json({message:"User not found"})
   } 
   return res.status(200).json({ user });
}

const addUser = async(req,res,next) =>{
   const {name,age,gender,phone,password} = req.body
   let user;
   try   
   {
      user = new User({
         name,
         age,
         gender,
         phone,
         password
      });
      await user.save();
   } catch (err) {
      console.log(err);
   }
   if(!user){
      return res.status(500).json({message:"Unable to add"})
   } 
   return res.status(201).json({user});
}

const updateUser = async(req,res,next) =>
{
   const id = req.params.id; 
   const {name,age,gender,phone,password} = req.body
   let user;
   try{
      user = await User.findByIdAndUpdate(id,
         {
            name,
            age,
            gender,
            phone,
            password
         });

         user = await user.save();
      }catch (err){
      console.log.apply(err)
   }
   if(!user){
      return res.status(404).json({message:"Unable to update by this Id"}); 
   } 
   return res.status(201).json({user});
}

const deleteUser = async(req,res,next) =>
{
   const id = req.params.id; 
   let user; 
   try{
      user = await User.findByIdAndDelete(id)
   }catch (err){
      console.log(err);
   }
   if(!user){
      return res.status(404).json({message:"Unable to delete by this Id"}); 
   } 
   return res.status(201).json({message: "User Deleted Successfully"});
}

exports.deleteUser = deleteUser;
exports.updateUser = updateUser;
exports.getById = getById;
exports.addUser = addUser;
exports.getAllUser = getAllUser;